<%- include('../partials/header') %>

<div class="container-fluid">
  <div class="row">
    <!-- Page Header -->
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h3 mb-0">Crime Hotspots</h1>
          <p class="text-muted">Geographic analysis of crime concentration areas</p>
        </div>
        <a href="/analysis" class="btn btn-secondary">
          <i class="fas fa-arrow-left me-2"></i>Back to Analysis
        </a>
      </div>
    </div>
  </div>

  <!-- Hotspot Statistics -->
  <div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-danger text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h4 class="mb-0"><%= hotspots.filter(h => h.severity === 'high').length %></h4>
              <p class="mb-0">High Risk Areas</p>
            </div>
            <i class="fas fa-exclamation-triangle fa-2x opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-warning text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h4 class="mb-0"><%= hotspots.filter(h => h.severity === 'medium').length %></h4>
              <p class="mb-0">Medium Risk Areas</p>
            </div>
            <i class="fas fa-exclamation-circle fa-2x opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-info text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h4 class="mb-0"><%= hotspots.filter(h => h.severity === 'low').length %></h4>
              <p class="mb-0">Low Risk Areas</p>
            </div>
            <i class="fas fa-info-circle fa-2x opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-success text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h4 class="mb-0"><%= hotspots.length %></h4>
              <p class="mb-0">Total Hotspots</p>
            </div>
            <i class="fas fa-map-marked-alt fa-2x opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hotspots Map Placeholder -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Hotspots Map</h5>
        </div>
        <div class="card-body">
          <div class="text-center py-5" style="background-color: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 0.375rem;">
            <i class="fas fa-map fa-3x text-muted mb-3"></i>
            <h5>Interactive Map</h5>
            <p class="text-muted">Crime hotspots visualization would be displayed here</p>
            <small class="text-muted">Integration with mapping services like Google Maps or Leaflet required</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hotspots List -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Crime Hotspots</h5>
        </div>
        <div class="card-body">
          <% if (hotspots.length === 0) { %>
            <div class="text-center py-4">
              <i class="fas fa-map-marked-alt fa-3x text-muted mb-3"></i>
              <h5>No hotspots identified</h5>
              <p class="text-muted">No crime hotspots have been detected yet.</p>
            </div>
          <% } else { %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Location</th>
                    <th>Severity</th>
                    <th>Crime Count</th>
                    <th>Risk Score</th>
                    <th>Time Pattern</th>
                    <th>Recent Activity</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% hotspots.forEach(hotspot => { %>
                    <tr>
                      <td>
                        <strong><%= hotspot.location %></strong>
                        <% if (hotspot.coordinates) { %>
                          <br>
                          <small class="text-muted">
                            <%= hotspot.coordinates.lat.toFixed(4) %>, <%= hotspot.coordinates.lng.toFixed(4) %>
                          </small>
                        <% } %>
                      </td>
                      <td>
                        <span class="badge bg-<%= hotspot.severity === 'high' ? 'danger' : hotspot.severity === 'medium' ? 'warning' : 'info' %>">
                          <%= hotspot.severity %>
                        </span>
                      </td>
                      <td>
                        <span class="badge bg-secondary">
                          <%= hotspot.crimeCount || 0 %>
                        </span>
                      </td>
                      <td>
                        <div class="progress" style="width: 80px;">
                          <div class="progress-bar bg-<%= hotspot.riskScore >= 0.8 ? 'danger' : hotspot.riskScore >= 0.6 ? 'warning' : 'info' %>" 
                               role="progressbar" 
                               style="width: <%= (hotspot.riskScore * 100) %>%">
                            <%= Math.round(hotspot.riskScore * 100) %>%
                          </div>
                        </div>
                      </td>
                      <td>
                        <% if (hotspot.timePattern) { %>
                          <%= hotspot.timePattern %>
                        <% } else { %>
                          <span class="text-muted">N/A</span>
                        <% } %>
                      </td>
                      <td>
                        <% if (hotspot.lastIncident) { %>
                          <%= new Date(hotspot.lastIncident).toLocaleDateString() %>
                        <% } else { %>
                          <span class="text-muted">N/A</span>
                        <% } %>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <button type="button" class="btn btn-sm btn-outline-primary" 
                                  onclick="viewHotspotDetails('<%= hotspot._id %>')">
                            <i class="fas fa-eye"></i>
                          </button>
                          <button type="button" class="btn btn-sm btn-outline-info" 
                                  onclick="showOnMap('<%= hotspot.coordinates ? hotspot.coordinates.lat : '' %>', '<%= hotspot.coordinates ? hotspot.coordinates.lng : '' %>')">
                            <i class="fas fa-map-marker-alt"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Hotspot Details Modal -->
<div class="modal fade" id="hotspotModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Hotspot Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="hotspotModalBody">
        <!-- Content loaded dynamically -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
function viewHotspotDetails(hotspotId) {
  // This would fetch and display detailed information about the hotspot
  document.getElementById('hotspotModalBody').innerHTML = `
    <div class="text-center">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading hotspot details...</p>
    </div>
  `;
  
  const modal = new bootstrap.Modal(document.getElementById('hotspotModal'));
  modal.show();
  
  // Simulate loading
  setTimeout(() => {
    document.getElementById('hotspotModalBody').innerHTML = `
      <div class="alert alert-info">
        <h6>Hotspot Analysis</h6>
        <p>Detailed analysis for hotspot ID: ${hotspotId}</p>
        <p>This would show comprehensive information about the selected hotspot including:</p>
        <ul>
          <li>Crime type breakdown</li>
          <li>Time-based patterns</li>
          <li>Historical trends</li>
          <li>Patrol recommendations</li>
        </ul>
      </div>
    `;
  }, 1000);
}

function showOnMap(lat, lng) {
  if (lat && lng) {
    // This would center the map on the hotspot location
    alert(`Would show location ${lat}, ${lng} on map`);
  } else {
    alert('No coordinates available for this hotspot');
  }
}
</script>

<%- include('../partials/footer') %>
